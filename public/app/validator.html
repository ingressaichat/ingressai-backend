<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Validador — IngressAI</title>
  <style>
    body{font:16px/1.45 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Ubuntu,Inter,system-ui,sans-serif;background:#f6f8fc;margin:0;color:#0b1220}
    .wrap{max-width:700px;margin:0 auto;padding:24px}
    .card{background:#fff;border:1px solid #e5ecff;border-radius:16px;box-shadow:0 10px 28px rgba(47,125,217,.14);padding:16px}
    .row{display:grid;gap:10px;grid-template-columns:1fr max-content}
    .input{border:1px solid #e5ecff;border-radius:12px;padding:.7rem .8rem;font:inherit}
    .btn{border:1px solid #d6e4ff;border-radius:999px;min-height:44px;padding:0 16px;background:#fff;font-weight:800;box-shadow:0 6px 18px rgba(47,125,217,.12)}
    .valid{color:#0b7a3b}.invalid{color:#a33a3a} a{text-decoration:underline}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Validador</h1>
      <p style="color:#5b6b86">Cole o código do QR (ex.: <code>ingressai:ticket:ABC123</code> ou só <code>ABC123</code>).</p>
      <div class="row">
        <input id="code" class="input" placeholder="Código do ingresso">
        <button id="check" class="btn">Checar</button>
      </div>
      <div id="res" style="margin-top:10px"></div>
      <p><a href="/">← Voltar</a></p>
    </div>
  </div>
  <script>
    const API = (location.origin + "/api").replace(/\/+$/,"");
    const $=s=>document.querySelector(s);
    $('#check').addEventListener('click', async ()=>{
      const raw = ($('#code').value||'').trim(); if(!raw){ $('#res').innerHTML='<span class="invalid">Informe um código.</span>'; return; }
      const code = raw.replace(/^ingressai:ticket:/i,'');
      try{
        $('#res').textContent='Checando…';
        const j = await fetch(API+'/validator/check',{method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},credentials:'include',body:JSON.stringify({code})}).then(r=>r.json());
        $('#res').innerHTML = j.valid
          ? `<span class="valid">✅ Válido — Ticket #${j.ticketId} • Evento: ${j.eventId} • Nome: ${j.buyerName||'-'}</span>`
          : `<span class="invalid">❌ Inválido (${j.reason||'desconhecido'})</span>`;
      }catch{ $('#res').innerHTML='<span class="invalid">❌ Erro na validação</span>'; }
    });
  </script>
</body>
</html>
